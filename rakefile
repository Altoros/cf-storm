################################
# In order to sandbox the test and dev env, we declare a
# different value for REDIS_URL when doing tests.
ENV["REDIS_URL"] = "redis://localhost:6379/13"

require_relative "./app"
require "cutest"

# Complex Structs
require_relative 'lib/fake_spaces'
require_relative 'lib/fake_routes'
require_relative 'lib/fake_apps'
require_relative 'lib/fake_client'
require_relative "test/helper"

task :default => 'test:all'

namespace 'test' do
  desc "Run tests in test/ folder"
  task :benchmark  do
    require 'cuba/capybara'
    require_relative "test/acceptance/acceptance_helper"

    puts "==> Runing Benchmark tests"
    Cutest.run Dir["test/benchmarks/*_test.rb"]
    puts '==> Finished!'
  end

  desc "Run tests in test/ folder"
  task :acceptance  do
    require 'cuba/capybara'
    require_relative "test/acceptance/acceptance_helper"

    puts "==> Runing acceptance tests"
    Cutest.run Dir["test/acceptance/**/*_test.rb"]
    puts '==> Finished!'
  end

  desc "Run model tests"
  task :unit do
    unit_files = Dir["test/models/*_test.rb"] +
                 Dir["test/helpers/*_test.rb"]

    puts "==> Runing unit tests"
    Cutest.run unit_files
    puts '==> Finished!'
  end

  desc "Run all tests acceptance + unit"
  task :all => [:unit, :acceptance]
end
